<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Turnierbaum – Warhammer 40k PvP Clash</title>
<style>
body { margin:0; font-family:Arial,sans-serif; background:#000; color:#eee; }
.topnav { display:flex; justify-content:center; background:#111; padding:0.8rem; gap:1.5rem; border-bottom:2px solid #ff4f4f; }
.topnav a { color:#eee; text-decoration:none; font-weight:bold; transition:0.2s; }
.topnav a:hover { color:#ff4f4f; }

.hero { position:relative; height:200px; display:flex; align-items:center; justify-content:center; text-align:center; background:#222; color:#fff; }
.hero .overlay { position:absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.6);}
.hero__content { position:relative; z-index:2; text-shadow:2px 2px 8px #000; }

.container { padding:1rem; display:flex; justify-content:center; flex-direction:column; gap:2rem; }
.bracket-container { display:flex; flex-direction:column; align-items:center; gap:3rem; width:100%; max-width:100%; }

.section-title { font-size:1.5rem; font-weight:bold; margin-bottom:1rem; text-align:center; color:#ff4f4f; }
.bracket { display:flex; flex-direction:row; gap:2rem; flex:0 0 auto; position:relative; }
.round { display:flex; flex-direction:column; justify-content:center; gap:2.5rem; min-width:120px; position:relative; }
.match-pair { display:flex; flex-direction:column; gap:0.3rem; position:relative; }
.team-box { background:#111; border:2px solid #ff4f4f; padding:0.5rem 0.8rem; border-radius:8px; text-align:center; min-width:100px; font-weight:bold; position:relative;}
.team-name { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

.center-final { display:flex; flex-direction:row; justify-content:center; align-items:center; gap:2rem; position:relative;}
.final-box { background:#222; border:2px solid #ff4f4f; padding:1rem 2rem; border-radius:10px; text-align:center; min-width:160px; font-weight:bold; position:relative; z-index:2;}
.muted { color:#aaa; font-size:0.9rem; position:absolute; top:100%; left:50%; transform:translateX(-50%); margin-top:0.3rem; }

.line { position:absolute; background:#ff4f4f; }

.line-horizontal { height:2px; }
.line-vertical { width:2px; }

@media(max-width:768px){
  .round { gap:2rem; min-width:80px; }
  .team-box { min-width:70px; padding:0.3rem 0.5rem; font-size:0.85rem; }
  .hero { height:180px; }
}

footer { text-align:center; padding:1rem; background:#111; border-top:2px solid #ff4f4f; margin-top:2rem;}
</style>
</head>
<body>

<nav class="topnav">
  <a href="index.html">Start</a>
  <a href="about.html">Überblick</a>
  <a href="rules.html">Regeln & Ablauf</a>
  <a href="bracket.html">Turnierbaum</a>
  <a href="report.html">Match-Reporting</a>
</nav>

<header class="hero">
  <div class="overlay"></div>
  <div class="hero__content">
    <h1>Turnierbaum</h1>
    <p>Doppel-Eliminierung – Trage die Teams direkt ins Sheet ein!</p>
  </div>
</header>

<main class="container">
  <div class="bracket-container">

    <div>
      <div class="section-title">Winner Bracket</div>
      <div class="bracket" id="winner-bracket"></div>
    </div>

    <div class="center-final" id="final-container">
      <div class="team-box" id="loser-left">TBD</div>
      <div class="final-box">Finale</div>
      <div class="team-box" id="loser-right">TBD</div>
    </div>

    <div>
      <div class="section-title">Loser Bracket</div>
      <div class="bracket" id="loser-bracket"></div>
    </div>

  </div>
</main>

<footer>© 2025 Warhammer 40k PvP Clash – Alle Rechte vorbehalten.</footer>

<script>
// --- Google Sheet Setup ---
const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRYv16SEpDn7IxjQVVJ3BKDwuEgYuCtWypJbKGe62pnuOpGH43ke2O-xWU96-EaCXAyGWLrJ23iaJuY/pub?output=csv';

// CSV parse
function parseCSV(csv){
  return csv.split('\n').map(row => row.split(',').map(cell => cell.replace(/"/g,'').trim()));
}

// Team Box erstellen
function createTeamBox(teamName){
  const div = document.createElement("div");
  div.classList.add("team-box");
  div.innerHTML = `<div class="team-name">${teamName || "TBD"}</div>`;
  return div;
}

// Match erstellen
function createMatchPair(team1, team2){
  const div = document.createElement("div");
  div.classList.add("match-pair");
  div.appendChild(createTeamBox(team1));
  div.appendChild(createTeamBox(team2));
  return div;
}

// Bracket erstellen
function generateBracket(container, roundsData){
  container.innerHTML = '';
  roundsData.forEach(round=>{
    const roundDiv = document.createElement("div");
    roundDiv.classList.add("round");
    round.forEach(match=>{
      const matchDiv = createMatchPair(match[0], match[1]);
      roundDiv.appendChild(matchDiv);
    });
    container.appendChild(roundDiv);
  });
}

// Beispiel Mapping
function loadBracket(){
  fetch(SHEET_URL)
    .then(res => res.text())
    .then(csv => {
      const data = parseCSV(csv);

      // Winner Bracket (Runde 1)
      const winnerRounds = [];
      for(let i=0;i<8;i++){
        winnerRounds.push([[data[0][i*2] || "TBD", data[0][i*2+1] || "TBD"]]);
      }

      // Loser Bracket (Runde 1)
      const loserRounds = [];
      for(let i=0;i<4;i++){
        loserRounds.push([[data[1] ? data[1][i*2] || "TBD" : "TBD", data[1] ? data[1][i*2+1] || "TBD" : "TBD"]]);
      }

      // Finalisten links/rechts vom Finale
      const finalLeft = data[2] && data[2][0] ? data[2][0] : "TBD";
      const finalRight = data[2] && data[2][1] ? data[2][1] : "TBD";
      document.getElementById("loser-left").innerText = finalLeft;
      document.getElementById("loser-right").innerText = finalRight;

      generateBracket(document.getElementById("winner-bracket"), winnerRounds);
      generateBracket(document.getElementById("loser-bracket"), loserRounds);
    })
    .catch(err=>console.error("Fehler beim Laden der Daten:",err));
}

loadBracket();
</script>

</body>
</html>
